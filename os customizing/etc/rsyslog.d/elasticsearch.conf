#### MODULES ####
module(load="omelasticsearch")
module(load="mmjsonparse")

### BEGIN ELASTICSEARCH
template(name="rsyslog-index"
  type="list") {
    constant(value="rsyslog-")
    property(name="timereported" dateFormat="rfc3339" position.from="1" position.to="4")
    constant(value=".")
    property(name="timereported" dateFormat="rfc3339" position.from="6" position.to="7")
    constant(value=".")
    property(name="timereported" dateFormat="rfc3339" position.from="9" position.to="10")
}

template(name="json-rsyslog"
         type="list"
         option.json="on") {
           constant(value="{")
             constant(value="\"@timestamp\":\"")               property(name="timereported" dateFormat="rfc3339")
             constant(value="\",\"message\":\"")               property(name="msg")
             constant(value="\",\"host\":\"")                  property(name="hostname")
             constant(value="\",\"fromhost\":\"")              property(name="fromhost")
             constant(value="\",\"fromhost-ip\":\"")           property(name="fromhost-ip")
             constant(value="\",\"input-type\":\"")            property(name="inputname")
             constant(value="\",\"priority\":\"")              property(name="syslogpriority-text")
             constant(value="\",\"priority-id\":\"")           property(name="syslogpriority")
             constant(value="\",\"severity\":\"")              property(name="syslogseverity-text")
             constant(value="\",\"severity-id\":\"")           property(name="syslogseverity")
             constant(value="\",\"facility\":\"")              property(name="syslogfacility-text")
             constant(value="\",\"facility-id\":\"")           property(name="syslogfacility")
             constant(value="\",\"programname\":\"")           property(name="programname")
             constant(value="\",\"syslogtag\":\"")             property(name="syslogtag")
           constant(value="\"}")
         }

action(type="omelasticsearch"
       server="localhost"
       serverport="9200"
       template="json-rsyslog"
       searchType="RSyslog-i-Vertix"
       searchIndex="rsyslog-index"
       dynSearchIndex="on"
       bulkmode="on"
       queue.type="linkedlist"
       queue.size="10000"
       queue.dequeuebatchsize="5000"
       queue.saveonshutdown="on"
       queue.workerthreads="5"
       action.resumeretrycount="-1")

### END ELASTICSEARCH
